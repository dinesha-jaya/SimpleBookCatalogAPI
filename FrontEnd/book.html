<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <title>Simple Book Catalog - Book</title>
</head>
<body class="container">

<header class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">
    <div class="col-md-3 mb-2 mb-md-0">
        <a class="d-inline-flex link-body-emphasis text-decoration-none" href="index.html">Simple Book Catalog</a>
    </div>

    <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
        <li><a class="nav-link px-2 link-secondary" href="search.html">Home</a></li>
        <li><a class="nav-link px-2" href="#">Features</a></li>
        <li><a class="nav-link px-2" href="#">FAQs</a></li>
        <li><a class="nav-link px-2" href="book.html">Manage Books</a></li>
    </ul>

    <div class="col-md-3 text-end">
        <button class="btn btn-outline-primary me-2" type="button">Login</button>
        <button class="btn btn-primary" type="button">Sign-up</button>
    </div>
</header>
<div class="b-example-divider"></div>

<form class="row g-3" id="newBookForm">
    <div class="col-md-12">
        <label class="form-label fw-bolder fs-5" for="newBookForm">Book</label>
    </div>
    <div class="col-md-12">
        <!--        <label class="form-label" for="inputBookTitle">Title</label>-->
        <input class="form-control" id="inputBookTitle" name="inputBookTitle" placeholder="Title of the Book"
               type="text">
    </div>
    <div class="col-md-12">
        <!--        <label class="form-label" for="inputBookTitle">Title</label>-->
        <input class="form-control" id="inputBookIsbn" name="inputBookIsbn" placeholder="ISBN" type="text">
    </div>
    <div>
        <div class="col-md-1" style="display: inline-block">
            <label class="form-label">Author(s)</label>
        </div>
        <div class="col-md-3" style="display: inline-block">
            <!--            <label class="form-label" for="inputFirstName">First Name</label>-->
            <input class="form-control" id="inputAuthorNos" name="inputAuthorNos" placeholder="Number of Authors"
                   type="text">
        </div>
        <div style="display: inline-block">
            <button class="btn btn-primary" id="btnBookAddAuthor" name="btnBookAddAuthor" type="button">+</button>
        </div>
    </div>
    <div id="divBookAuthors">
        <!--        <div class="col-md-5" style="display: inline-block">-->
        <!--&lt;!&ndash;            <label class="form-label" for="inputFirstName">First Name</label>&ndash;&gt;-->
        <!--            <input class="form-control" id="inputFirstName" name="inputFirstName" type="text" placeholder="FirstName">-->
        <!--        </div>-->
        <!--        <div class="col-md-5" style="display: inline-block">-->
        <!--&lt;!&ndash;            <label class="form-label" for="inputLastName">Last Name</label>&ndash;&gt;-->
        <!--            <input class="form-control" id="inputLastName" name="inputLastName" type="text" placeholder="LastName">-->
        <!--        </div>-->
    </div>
    <div class="col-md-6">
        <!--        <label class="form-label" for="inputBookTitle">Title</label>-->
        <input class="form-control" id="inputBookPrice" name="inputBookPrice" placeholder="Price Rs." type="text">
    </div>


    <!--                <div><label class="form-label">First Name</label></div>-->
    <!--                <div><input class="form-control" id="inputBookFirstName" name="inputBookFirstName"-->
    <!--                            type="text"></div>-->
    <!--                <div><label class="form-label">Last name</label></div>-->
    <!--                <div><input class="form-control" id="inputBookLastName" name="inputBookLastName"-->
    <!--                            type="text"></div>-->
    <!--            -->

    <div class="col-md-7">
        <button class="btn btn-primary" id="btnBookAdd" name="btnBookAdd" type="button">Add Book</button>
        <button class="btn btn-info" data-bs-target="#bookGetModal" data-bs-toggle="modal" id="btnBookGet"
                type="button">Get Book
        </button>
        <button class="btn btn-warning" data-bs-target="#bookUpdateModal" data-bs-toggle="modal" id="btnBookUpdate"
                type="button">Update Book
        </button>
        <button class="btn btn-danger" data-bs-target="#bookDeleteModal" data-bs-toggle="modal" id="btnBookDelete"
                type="button">Delete Book
        </button>
    </div>

    <div aria-hidden="true" aria-labelledby="staticBackdropLabel" class="modal fade" data-bs-backdrop="static"
         data-bs-keyboard="false"
         id="bookGetModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="bookGetModalStaticBackdropLabel">Book</h1>
                    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                </div>
                <div class="modal-body">
                    <label class="form-label fw-bolder fs-6" id="getBookMTitle" name="getBookMTitle"></label>
                    <br>
                    <label class="form-label fw-bolder fs-6" id="getBookMIsbn" name="getBookMIsbn"></label>
                    <br>
                    <label class="form-label fw-bolder fs-6">Author(s) : </label>
                    <div id="getBookAuthors"></div>
                    <br>
                    <label class="form-label fw-bolder fs-6" id="getBookMPrice" name="getBookMPrice"></label>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-info" data-bs-dismiss="modal" type="button">Close</button>
                    <!--                    <button type="button" class="btn btn-primary">Understood</button>-->
                </div>
            </div>
        </div>
    </div>

    <div aria-hidden="true" aria-labelledby="staticBackdropLabel" class="modal fade" data-bs-backdrop="static"
         data-bs-keyboard="false"
         id="bookUpdateModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="bookUpdateModalStaticBackdropLabel">Book</h1>
                    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                </div>
                <div class="modal-body">
                    <label class="form-label fw-bolder fs-6" id="updateBookMTitle" name="updateBookMTitle"></label>
                    <br>
                    <label class="form-label fw-bolder fs-6" id="updateBookMIsbn" name="updateBookMIsbn"></label>
                    <br>
                    <label class="form-label fw-bolder fs-6">Author(s) : </label>
                    <div id="updateBookAuthors"></div>
                    <br>
                    <label class="form-label fw-bolder fs-6" id="updateBookMPrice" name="updateBookMPrice"></label>
                    <br>
                    <input class="form-control" id="updateBookMNewPrice" name="updateBookMNewPrice" placeholder="New Prrice"
                           type="text">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
                    <button class="btn btn-warning" id="btnUpdateBook" type="button">Update Book</button>
                </div>
            </div>
        </div>
    </div>

    <div aria-hidden="true" aria-labelledby="staticBackdropLabel" class="modal fade" data-bs-backdrop="static"
         data-bs-keyboard="false"
         id="bookDeleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="bookDeleteModalStaticBackdropLabel">Delete Book</h1>
                    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                </div>
                <div class="modal-body">
                    <label class="form-label fw-bolder fs-5" id="deleteBookMTitle" name="deleteBookMTitle"></label>
                    <label class="form-label fw-bolder fs-5" id="deleteBookMIsbn" name="deleteBookMIsbn"></label>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
                    <button class="btn btn-danger" type="button">Delete Book</button>
                </div>
            </div>
        </div>
    </div>
</form>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery-3.7.0.min.js"></script>
<script>

    $('#btnBookAddAuthor').click(function () {
        let authorNos = $("#inputAuthorNos").val();

        let divAuthors = document.getElementById("divBookAuthors");

        while (divAuthors.hasChildNodes()) {
            divAuthors.removeChild(divAuthors.lastChild);
        }

        let fragment = document.createDocumentFragment();

        for (let i = 0; i < authorNos; i++) {
            let divFName = document.createElement("div");
            divFName.setAttribute("class", "col-md-6");
            divFName.setAttribute("style", "display: inline-block");
            let inputFName = document.createElement("input");
            inputFName.setAttribute("class", 'form-control inputAuthorFName');
            inputFName.setAttribute('type', 'text');
            inputFName.setAttribute("placeholder", "First Name");
            inputFName.setAttribute("id", (`inputAuthorFName${i}`));
            // inputFName.setAttribute("name", "inputAuthorFName");

            let divLName = document.createElement("div");
            divLName.setAttribute("class", "col-md-6");
            divLName.setAttribute("style", "display: inline-block");
            let inputLName = document.createElement("input");
            inputLName.setAttribute("class", 'form-control inputAuthorLName');
            inputLName.setAttribute('type', 'text');
            inputLName.setAttribute("placeholder", "Last Name");
            inputLName.setAttribute("id", (`inputAuthorLName${i}`));
            // inputLName.setAttribute("class", "inputAuthorLName");

            divFName.append(inputFName);
            divLName.append(inputLName);

            let divF = fragment.appendChild(divFName);
            let divL = fragment.appendChild(divLName);

            // console.log(divF);
            // console.log(divL);

            $("#divBookAuthors").append(divF, divL);
        }
    });

    $("#btnBookAdd").click(function () {
        let authorBook = {
            title: "",
            isbn: "",
            price: 0.0,
            authorList: []
        }

        let authors = [];

        let title = $("#inputBookTitle").val();
        let isbn = $("#inputBookIsbn").val();

        let firstNames = document.querySelectorAll(".inputAuthorFName");
        let lastNames = document.querySelectorAll(".inputAuthorLName");

        console.log(firstNames);
        console.log(lastNames);

        for (let i = 0; i < firstNames.length; i++) {
            let author = {
                firstName: "",
                lastName: ""
            }

            let firstNameNode = document.querySelector(`input#inputAuthorFName${i}`);
            let lastNameNode = document.querySelector(`input#inputAuthorLName${i}`);

            let firstName = firstNameNode.value;
            let lastName = lastNameNode.value;

            author.firstName = firstName;
            author.lastName = lastName;

            authors.push(author);
        }

        let price = $("#inputBookPrice").val();

        authorBook.title = title;
        authorBook.isbn = isbn;
        authorBook.price = parseFloat(price);
        authorBook.authorList = authors;

        console.log(authorBook);

        $.ajax({
            url: 'http://localhost:8080/books/book',
            method: 'post',
            contentType: 'application/json',
            data: JSON.stringify(authorBook),
            // dataType: "json",
            success: function (resp) {
                alert(resp.message);
            },
            error: function (error) {
                let cause = JSON.parse(error.responseText).message;
                alert(cause);
            }
        });
    })

    $("#btnBookGet").click(function () {
        let isbn = $("#inputBookIsbn").val();

        // console.log(isbn);

        let response = null;

        async function asyncBookGet() {
            try {
                const res = await $.ajax({
                    url: 'http://localhost:8080/books/book?isbn=' + isbn,
                    dataType: 'json',
                    success: function (resp) {
                        response = resp.data;
                        // console.log(response);
                    },
                    error: function (error) {
                        let cause = JSON.parse(error.responseText).message;
                        alert(cause);
                    }
                }).then(() => {
                    $("#getBookMTitle").html("Title : " + response.title);
                    $("#getBookMIsbn").html("ISBN : " + response.isbn);

                    for (let i = 0; i < response.authorList.length; i++) {
                        let lblFName = document.createElement("label");
                        lblFName.setAttribute("class", "form-label fw-bolder fs-6");
                        lblFName.innerHTML = response.authorList[i].firstName + " " + response.authorList[i].lastName;
                        // console.log(lblFName);
                        $("#getBookAuthors").append(lblFName);
                    }

                    $("#getBookMPrice").html("Price : " + response.price);
                });
            } catch (err) {
                console.log(err);
            }
        }

        asyncBookGet();
    });

    $("#btnBookUpdate").click(function () {
        let isbn = $("#inputBookIsbn").val();

        let response = null;
        // let newPrice = null;

        async function asyncBookUpdate() {
            try {
                const res = await $.ajax({
                    url: 'http://localhost:8080/books/book?isbn=' + isbn,
                    dataType: 'json',
                    success: function (resp) {
                        response = resp.data;
                        // console.log(response);
                    },
                    error: function (error) {
                        // let cause = JSON.parse(error.responseText).message;
                        alert(error);
                    }
                }).then(() => {
                    $("#updateBookMTitle").html("Title : " + response.title);
                    $("#updateBookMIsbn").html("ISBN : " + response.isbn);

                    for (let i = 0; i < response.authorList.length; i++) {
                        let lblName = document.createElement("label");
                        lblName.setAttribute("class", "form-label fw-bolder fs-6");
                        lblName.innerHTML = response.authorList[i].firstName + " " + response.authorList[i].lastName;
                        // console.log(lblFName);
                        $("#updateBookAuthors").append(lblName);
                    }

                    $("#updateBookMPrice").html("Price : " + response.price);
                });
            } catch (err) {
                console.log(err);
            }
        }

        asyncBookUpdate();


    });


    $("#btnUpdateBook").click(function () {
        let newPrice = $("#updateBookMNewPrice").val();
        let isbn = $("#inputBookIsbn").val();
        // console.log(newPrice);
        // console.log(isbn);

        async function asyncBookUpdatePrice() {
            try {
                const res = await $.ajax({
                    url: 'http://localhost:8080/books/book/update?isbn=' + isbn + '&price=' + newPrice,
                    method: "post",
                    // dataType: 'json',
                    // success: function (resp) {
                    //     // responseMessage = resp.message;
                    //     // console.log(responseMessage);
                    // },
                    error: function (error) {
                        // let cause = JSON.parse(error.responseText).message;
                        alert(error);
                    }
                }).then(() => {
                    alert("The Price has been updated");

                });
            } catch (err) {
                console.log(err);
            }
        }

        asyncBookUpdatePrice();
    });

    $("#btnBookDelete").click(function () {
        let isbn = $("#inputBookIsbn").val();

    });


</script>

</body>
</html>